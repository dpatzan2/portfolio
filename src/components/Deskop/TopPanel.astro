---
// Top Panel Component - Ubuntu-style top bar with functional menus
---

<div
  class="fixed top-0 left-0 right-0 h-7 bg-ubuntu-panel flex items-center justify-between px-2.5 text-white text-xs z-50"
>
  <!-- Left side - Activities and App Menu -->
  <div class="flex items-center gap-1">
    <!-- Activities Button -->
    <button
      id="activities-btn"
      class="flex items-center hover:bg-white/10 px-2 py-1 rounded cursor-pointer transition-colors"
    >
      <div class="w-3 h-3 bg-ubuntu-orange rounded-full mr-1.5"></div>
      <span>Activities</span>
    </button>

    <!-- App Menu (context-sensitive) -->
    <div id="app-menu" class="flex items-center gap-0.5 ml-2">
      <!-- Files Menu -->
      <div class="menu-container relative">
        <button
          class="menu-btn hover:bg-white/10 px-2 py-1 rounded cursor-pointer transition-colors"
          >Files</button
        >
        <div
          class="menu-dropdown hidden absolute top-full left-0 mt-1 bg-ubuntu-header rounded-lg shadow-xl border border-white/10 py-1 min-w-40 z-50"
        >
          <button class="menu-item" data-action="open-projects">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="14"
              height="14"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              ><path
                d="M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z"
              ></path></svg
            >
            Proyectos
          </button>
          <button class="menu-item" data-action="open-pdfviewer">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="14"
              height="14"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              ><path
                d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"
              ></path><polyline points="14 2 14 8 20 8"></polyline></svg
            >
            Ver CV
          </button>
          <div class="menu-divider"></div>
          <button class="menu-item" data-action="close-all">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="14"
              height="14"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              ><line x1="18" x2="6" y1="6" y2="18"></line><line
                x1="6"
                x2="18"
                y1="6"
                y2="18"></line></svg
            >
            Cerrar todo
          </button>
        </div>
      </div>

      <!-- View Menu -->
      <div class="menu-container relative">
        <button
          class="menu-btn hover:bg-white/10 px-2 py-1 rounded cursor-pointer transition-colors"
          >View</button
        >
        <div
          class="menu-dropdown hidden absolute top-full left-0 mt-1 bg-ubuntu-header rounded-lg shadow-xl border border-white/10 py-1 min-w-44 z-50"
        >
          <button class="menu-item" data-action="open-profile">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="14"
              height="14"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              ><circle cx="12" cy="8" r="5"></circle><path
                d="M20 21a8 8 0 0 0-16 0"></path></svg
            >
            Perfil
          </button>
          <button class="menu-item" data-action="open-projects">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="14"
              height="14"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              ><path
                d="M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z"
              ></path></svg
            >
            Proyectos
          </button>
          <button class="menu-item" data-action="open-terminal">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="14"
              height="14"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              ><polyline points="4 17 10 11 4 5"></polyline><line
                x1="12"
                x2="20"
                y1="19"
                y2="19"></line></svg
            >
            Terminal
          </button>
          <button class="menu-item" data-action="open-pdfviewer">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="14"
              height="14"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              ><path
                d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"
              ></path><polyline points="14 2 14 8 20 8"></polyline></svg
            >
            Visor de Documentos
          </button>
        </div>
      </div>

      <!-- Help Menu -->
      <div class="menu-container relative">
        <button
          class="menu-btn hover:bg-white/10 px-2 py-1 rounded cursor-pointer transition-colors"
          >Help</button
        >
        <div
          class="menu-dropdown hidden absolute top-full left-0 mt-1 bg-ubuntu-header rounded-lg shadow-xl border border-white/10 py-1 min-w-48 z-50"
        >
          <button class="menu-item" data-action="about">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="14"
              height="14"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              ><circle cx="12" cy="12" r="10"></circle><path d="M12 16v-4"
              ></path><path d="M12 8h.01"></path></svg
            >
            Acerca de este Portfolio
          </button>
          <button class="menu-item" data-action="open-terminal-help">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="14"
              height="14"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              ><polyline points="4 17 10 11 4 5"></polyline><line
                x1="12"
                x2="20"
                y1="19"
                y2="19"></line></svg
            >
            Comandos de Terminal
          </button>
          <div class="menu-divider"></div>
          <a
            href="https://github.com/dpatzan2"
            target="_blank"
            class="menu-item"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="14"
              height="14"
              viewBox="0 0 24 24"
              fill="currentColor"
              ><path
                d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"
              ></path></svg
            >
            GitHub
          </a>
        </div>
      </div>
    </div>
  </div>

  <!-- Date/Time with Calendar Dropdown -->
  <div class="calendar-container relative">
    <button
      id="datetime-btn"
      class="hover:bg-white/10 px-2 py-1 rounded cursor-pointer transition-colors"
    >
      <span id="datetime-display">Cargando...</span>
    </button>

    <!-- Calendar Dropdown -->
    <div
      id="calendar-dropdown"
      class="hidden absolute top-full right-0 mt-1 bg-ubuntu-header rounded-xl shadow-2xl border border-white/10 p-4 z-50 min-w-72"
    >
      <div class="calendar-header flex items-center justify-between mb-4">
        <button
          id="prev-month"
          class="p-1 hover:bg-white/10 rounded transition-colors"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="16"
            height="16"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"><path d="M15 18l-6-6 6-6"></path></svg
          >
        </button>
        <span id="calendar-month-year" class="text-white font-medium"></span>
        <button
          id="next-month"
          class="p-1 hover:bg-white/10 rounded transition-colors"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="16"
            height="16"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"><path d="M9 18l6-6-6-6"></path></svg
          >
        </button>
      </div>

      <div class="calendar-weekdays grid grid-cols-7 gap-1 mb-2">
        <span class="text-center text-white/50 text-xs py-1">Do</span>
        <span class="text-center text-white/50 text-xs py-1">Lu</span>
        <span class="text-center text-white/50 text-xs py-1">Ma</span>
        <span class="text-center text-white/50 text-xs py-1">Mi</span>
        <span class="text-center text-white/50 text-xs py-1">Ju</span>
        <span class="text-center text-white/50 text-xs py-1">Vi</span>
        <span class="text-center text-white/50 text-xs py-1">Sá</span>
      </div>

      <div id="calendar-days" class="grid grid-cols-7 gap-1">
        <!-- Days will be inserted here -->
      </div>

      <div class="mt-4 pt-3 border-t border-white/10">
        <div class="text-center">
          <span id="calendar-full-date" class="text-white/70 text-sm"></span>
        </div>
      </div>
    </div>
  </div>

  <!-- System icons -->
  <div class="flex items-center gap-1">
    <!-- Volume -->
    <button
      class="system-btn hover:bg-white/10 p-1 rounded cursor-pointer transition-colors"
      title="Volumen"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="14"
        height="14"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
        ><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><path
          d="M15.54 8.46a5 5 0 0 1 0 7.07"></path><path
          d="M19.07 4.93a10 10 0 0 1 0 14.14"></path></svg
      >
    </button>
    <!-- Battery -->
    <button
      class="system-btn hover:bg-white/10 p-1 rounded cursor-pointer transition-colors"
      title="Batería: 100%"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="14"
        height="14"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
        ><rect x="1" y="6" width="18" height="12" rx="2"></rect><line
          x1="23"
          x2="23"
          y1="10"
          y2="14"></line></svg
      >
    </button>
    <!-- Power -->
    <button
      id="power-btn"
      class="system-btn hover:bg-white/10 p-1 rounded cursor-pointer transition-colors"
      title="Apagar"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="14"
        height="14"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
        ><path d="M18.36 6.64a9 9 0 1 1-12.73 0"></path><line
          x1="12"
          x2="12"
          y1="2"
          y2="12"></line></svg
      >
    </button>
  </div>
</div>

<!-- Activities Overview Overlay -->
<div
  id="activities-overlay"
  class="fixed inset-0 bg-black/80 z-40 hidden opacity-0 transition-opacity duration-300"
>
  <div class="h-full flex flex-col items-center justify-center gap-8 p-8">
    <h2 class="text-white text-2xl font-light">Ventanas Abiertas</h2>
    <div
      id="windows-preview"
      class="flex flex-wrap justify-center gap-6 max-w-5xl"
    >
      <!-- Windows previews will be inserted here -->
    </div>
    <p class="text-white/50 text-sm">
      Haz clic en una ventana para enfocarla, o presiona Esc para cerrar
    </p>
  </div>
</div>

<!-- About Dialog -->
<div
  id="about-dialog"
  class="fixed inset-0 bg-black/50 z-50 hidden items-center justify-center"
>
  <div
    class="bg-ubuntu-header rounded-xl shadow-2xl border border-white/10 p-6 max-w-md mx-4"
  >
    <div class="text-center">
      <div
        class="w-20 h-20 bg-ubuntu-orange rounded-full mx-auto mb-4 flex items-center justify-center"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="40"
          height="40"
          viewBox="0 0 24 24"
          fill="none"
          stroke="white"
          stroke-width="2"
          ><circle cx="12" cy="8" r="5"></circle><path d="M20 21a8 8 0 0 0-16 0"
          ></path></svg
        >
      </div>
      <h2 class="text-white text-xl font-bold mb-2">Diego Patzán Portfolio</h2>
      <p class="text-white/70 text-sm mb-4">Versión 1.0.0</p>
      <p class="text-white/60 text-xs mb-4">
        Portfolio personal<br />
        Construido con Astro y TailwindCSS.
      </p>
      <div class="flex gap-2 justify-center">
        <a
          href="https://github.com/dpatzan2"
          target="_blank"
          class="px-4 py-2 bg-ubuntu-orange hover:bg-ubuntu-orange/80 text-white rounded-lg text-sm transition-colors"
        >
          GitHub
        </a>
        <button
          id="close-about"
          class="px-4 py-2 bg-white/10 hover:bg-white/20 text-white rounded-lg text-sm transition-colors"
        >
          Cerrar
        </button>
      </div>
    </div>
  </div>
</div>

<style>
  .menu-dropdown {
    animation: menuSlide 0.15s ease-out;
  }

  #calendar-dropdown {
    animation: menuSlide 0.15s ease-out;
  }

  @keyframes menuSlide {
    from {
      opacity: 0;
      transform: translateY(-5px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .menu-item {
    @apply w-full flex items-center gap-2 px-3 py-1.5 text-left text-white/90 hover:bg-ubuntu-orange/50 transition-colors text-xs;
  }

  .menu-divider {
    @apply h-px bg-white/10 my-1;
  }
</style>

<script>
  // Date/Time update
  function updateDateTime() {
    const now = new Date();
    const days = ["Dom", "Lun", "Mar", "Mié", "Jue", "Vie", "Sáb"];
    const months = [
      "Ene",
      "Feb",
      "Mar",
      "Abr",
      "May",
      "Jun",
      "Jul",
      "Ago",
      "Sep",
      "Oct",
      "Nov",
      "Dic",
    ];

    const formattedDate = `${days[now.getDay()]} ${now.getDate()} ${months[now.getMonth()]} ${now.getHours().toString().padStart(2, "0")}:${now.getMinutes().toString().padStart(2, "0")}`;

    const dateElement = document.getElementById("datetime-display");
    if (dateElement) dateElement.textContent = formattedDate;
  }

  updateDateTime();
  setInterval(updateDateTime, 1000);

  // Calendar functionality
  let currentCalendarDate = new Date();
  const calendarDropdown = document.getElementById("calendar-dropdown");
  const datetimeBtn = document.getElementById("datetime-btn");
  const calendarDays = document.getElementById("calendar-days");
  const calendarMonthYear = document.getElementById("calendar-month-year");
  const calendarFullDate = document.getElementById("calendar-full-date");
  const prevMonthBtn = document.getElementById("prev-month");
  const nextMonthBtn = document.getElementById("next-month");

  const monthNames = [
    "Enero",
    "Febrero",
    "Marzo",
    "Abril",
    "Mayo",
    "Junio",
    "Julio",
    "Agosto",
    "Septiembre",
    "Octubre",
    "Noviembre",
    "Diciembre",
  ];
  const dayNames = [
    "Domingo",
    "Lunes",
    "Martes",
    "Miércoles",
    "Jueves",
    "Viernes",
    "Sábado",
  ];

  function renderCalendar() {
    if (!calendarDays || !calendarMonthYear || !calendarFullDate) return;

    const year = currentCalendarDate.getFullYear();
    const month = currentCalendarDate.getMonth();
    const today = new Date();

    // Update header
    calendarMonthYear.textContent = `${monthNames[month]} ${year}`;

    // Update full date
    calendarFullDate.textContent = `${dayNames[today.getDay()]}, ${today.getDate()} de ${monthNames[today.getMonth()]} de ${today.getFullYear()}`;

    // Get first day of month and total days
    const firstDay = new Date(year, month, 1).getDay();
    const daysInMonth = new Date(year, month + 1, 0).getDate();
    const daysInPrevMonth = new Date(year, month, 0).getDate();

    calendarDays.innerHTML = "";

    // Previous month days
    for (let i = firstDay - 1; i >= 0; i--) {
      const day = document.createElement("span");
      day.className = "text-center text-white/30 text-xs py-1.5 rounded";
      day.textContent = String(daysInPrevMonth - i);
      calendarDays.appendChild(day);
    }

    // Current month days
    for (let i = 1; i <= daysInMonth; i++) {
      const day = document.createElement("span");
      const isToday =
        i === today.getDate() &&
        month === today.getMonth() &&
        year === today.getFullYear();
      day.className = `text-center text-xs py-1.5 rounded cursor-pointer transition-colors ${
        isToday
          ? "bg-ubuntu-orange text-white font-bold"
          : "text-white hover:bg-white/10"
      }`;
      day.textContent = String(i);
      calendarDays.appendChild(day);
    }

    // Next month days
    const totalCells = firstDay + daysInMonth;
    const remainingCells = totalCells > 35 ? 42 - totalCells : 35 - totalCells;
    for (let i = 1; i <= remainingCells; i++) {
      const day = document.createElement("span");
      day.className = "text-center text-white/30 text-xs py-1.5 rounded";
      day.textContent = String(i);
      calendarDays.appendChild(day);
    }
  }

  // Toggle calendar
  datetimeBtn?.addEventListener("click", (e) => {
    e.stopPropagation();
    // Close other dropdowns
    document
      .querySelectorAll(".menu-dropdown")
      .forEach((d) => d.classList.add("hidden"));

    currentCalendarDate = new Date();
    renderCalendar();
    calendarDropdown?.classList.toggle("hidden");
  });

  // Navigation
  prevMonthBtn?.addEventListener("click", (e) => {
    e.stopPropagation();
    currentCalendarDate.setMonth(currentCalendarDate.getMonth() - 1);
    renderCalendar();
  });

  nextMonthBtn?.addEventListener("click", (e) => {
    e.stopPropagation();
    currentCalendarDate.setMonth(currentCalendarDate.getMonth() + 1);
    renderCalendar();
  });

  // Close calendar on outside click
  document.addEventListener("click", (e) => {
    if (
      !calendarDropdown?.contains(e.target as Node) &&
      e.target !== datetimeBtn
    ) {
      calendarDropdown?.classList.add("hidden");
    }
  });

  // Menu handling
  document.querySelectorAll(".menu-container").forEach((container) => {
    const btn = container.querySelector(".menu-btn");
    const dropdown = container.querySelector(".menu-dropdown");

    btn?.addEventListener("click", (e) => {
      e.stopPropagation();
      // Close other menus
      document.querySelectorAll(".menu-dropdown").forEach((d) => {
        if (d !== dropdown) d.classList.add("hidden");
      });
      dropdown?.classList.toggle("hidden");
    });
  });

  // Close menus on click outside
  document.addEventListener("click", () => {
    document
      .querySelectorAll(".menu-dropdown")
      .forEach((d) => d.classList.add("hidden"));
  });

  // Menu actions
  document.querySelectorAll(".menu-item[data-action]").forEach((item) => {
    item.addEventListener("click", () => {
      const action = (item as HTMLElement).dataset.action;
      const wm = (window as any).windowManager;

      switch (action) {
        case "open-profile":
          wm?.openWindow("profile");
          break;
        case "open-projects":
          wm?.openWindow("projects");
          break;
        case "open-terminal":
          wm?.openWindow("terminal");
          break;
        case "open-pdfviewer":
          wm?.openWindow("pdfviewer");
          break;
        case "close-all":
          ["profile", "projects", "terminal", "pdfviewer"].forEach((id) =>
            wm?.closeWindow(id),
          );
          break;
        case "about":
          document.getElementById("about-dialog")?.classList.remove("hidden");
          document.getElementById("about-dialog")?.classList.add("flex");
          break;
        case "open-terminal-help":
          wm?.openWindow("terminal");
          break;
      }

      document
        .querySelectorAll(".menu-dropdown")
        .forEach((d) => d.classList.add("hidden"));
    });
  });

  // About dialog
  document.getElementById("close-about")?.addEventListener("click", () => {
    document.getElementById("about-dialog")?.classList.add("hidden");
    document.getElementById("about-dialog")?.classList.remove("flex");
  });

  // Activities overlay
  const activitiesBtn = document.getElementById("activities-btn");
  const activitiesOverlay = document.getElementById("activities-overlay");
  const windowsPreview = document.getElementById("windows-preview");

  activitiesBtn?.addEventListener("click", () => {
    showActivities();
  });

  function showActivities() {
    const wm = (window as any).windowManager;
    if (!wm) return;

    const states = wm.getWindowStates();
    if (!windowsPreview) return;

    windowsPreview.innerHTML = "";

    states.forEach((state: any, id: string) => {
      if (!state.isOpen || state.isMinimized) return;

      const preview = document.createElement("div");
      preview.className = "window-preview cursor-pointer group";
      preview.innerHTML = `
        <div class="w-64 h-40 bg-ubuntu-window rounded-lg border-2 border-transparent group-hover:border-ubuntu-orange transition-colors overflow-hidden shadow-xl">
          <div class="bg-ubuntu-header p-2 text-xs text-white">${state.element.dataset.windowTitle || id}</div>
          <div class="p-2 text-white/50 text-xs">Vista previa</div>
        </div>
        <p class="text-white text-center mt-2 text-sm">${state.element.dataset.windowTitle || id}</p>
      `;

      preview.addEventListener("click", () => {
        hideActivities();
        wm.focusWindow(id);
      });

      windowsPreview.appendChild(preview);
    });

    if (windowsPreview.children.length === 0) {
      windowsPreview.innerHTML =
        '<p class="text-white/50">No hay ventanas abiertas</p>';
    }

    activitiesOverlay?.classList.remove("hidden");
    setTimeout(() => activitiesOverlay?.classList.remove("opacity-0"), 10);
  }

  function hideActivities() {
    activitiesOverlay?.classList.add("opacity-0");
    setTimeout(() => activitiesOverlay?.classList.add("hidden"), 300);
  }

  activitiesOverlay?.addEventListener("click", (e) => {
    if (e.target === activitiesOverlay) hideActivities();
  });

  document.addEventListener("keydown", (e) => {
    if (e.key === "Escape") {
      hideActivities();
      document.getElementById("about-dialog")?.classList.add("hidden");
    }
  });

  // Power button (just for show)
  document.getElementById("power-btn")?.addEventListener("click", () => {
    alert("¡Gracias por visitar mi portfolio!");
  });
</script>
